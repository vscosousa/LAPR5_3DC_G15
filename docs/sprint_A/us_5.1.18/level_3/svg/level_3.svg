<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3203px" preserveAspectRatio="none" style="width:4281px;height:3203px;background:#FFFFFF;" version="1.1" viewBox="0 0 4281 3203" width="4281px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="391" x="1943.5" y="27.9951">Doctor Operation Request Deletion Flow - Level 3</text><rect fill="#FFFFFF" height="2497.4688" style="stroke:#181818;stroke-width:1.0;" width="10" x="732" y="281.2656"/><rect fill="#FFFFFF" height="2668.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="1431" y="438.6719"/><rect fill="#FFFFFF" height="1627.3125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1436" y="1114.1406"/><rect fill="#FFFFFF" height="227.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="2038" y="2174.1094"/><rect fill="none" height="201.25" style="stroke:#000000;stroke-width:1.5;" width="835" x="10" y="876.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="737" x2="737" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1436" x2="1436" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2042.5" x2="2042.5" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2797" x2="2797" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2983" x2="2983" y1="125.5781" y2="3116.1094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="3286" x2="3286" y1="125.5781" y2="3116.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="66" x="20" y="120.8613">Doctor</text><ellipse cx="56" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,58.7969 L56,85.7969 M43,66.7969 L69,66.7969 M56,85.7969 L43,100.7969 M56,85.7969 L69,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="66" x="20" y="3133.6738">Doctor</text><ellipse cx="56" cy="3146.8906" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,3154.8906 L56,3181.8906 M43,3162.8906 L69,3162.8906 M56,3181.8906 L43,3196.8906 M56,3181.8906 L69,3196.8906 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="639" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="646" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="687.5" y="112.8613">Controller</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="639" y="3115.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="646" y="3140.6738">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="687.5" y="3163.9551">Controller</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="1338" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1345" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="73" x="1399.5" y="112.8613">Service</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="1338" y="3115.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1345" y="3140.6738">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="73" x="1399.5" y="3163.9551">Service</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="1955.5" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="161" x="1962.5" y="89.5801">PlanningModule</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="74" x="2006" y="112.8613">Notifier</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="1955.5" y="3115.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="161" x="1962.5" y="3140.6738">PlanningModule</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="74" x="2006" y="3163.9551">Notifier</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="2719" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="142" x="2726" y="112.8613">LogRepository</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="2719" y="3115.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="142" x="2726" y="3140.6738">LogRepository</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2885" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="2892" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="106" x="2930" y="112.8613">Repository</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2885" y="3115.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="2892" y="3140.6738">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="106" x="2930" y="3163.9551">Repository</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="94" x="3236" y="120.8613">Database</text><path d="M3268,66.2969 C3268,56.2969 3286,56.2969 3286,56.2969 C3286,56.2969 3304,56.2969 3304,66.2969 L3304,92.2969 C3304,102.2969 3286,102.2969 3286,102.2969 C3286,102.2969 3268,102.2969 3268,92.2969 L3268,66.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M3268,66.2969 C3268,76.2969 3286,76.2969 3286,76.2969 C3286,76.2969 3304,76.2969 3304,66.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="94" x="3236" y="3133.6738">Database</text><path d="M3268,3148.3906 C3268,3138.3906 3286,3138.3906 3286,3138.3906 C3286,3138.3906 3304,3138.3906 3304,3148.3906 L3304,3174.3906 C3304,3184.3906 3286,3184.3906 3286,3184.3906 C3286,3184.3906 3268,3184.3906 3268,3174.3906 L3268,3148.3906 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M3268,3148.3906 C3268,3158.3906 3286,3158.3906 3286,3158.3906 C3286,3158.3906 3304,3158.3906 3304,3148.3906 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="2497.4688" style="stroke:#181818;stroke-width:1.0;" width="10" x="732" y="281.2656"/><rect fill="#FFFFFF" height="2668.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="1431" y="438.6719"/><rect fill="#FFFFFF" height="1627.3125" style="stroke:#181818;stroke-width:1.0;" width="10" x="1436" y="1114.1406"/><rect fill="#FFFFFF" height="227.25" style="stroke:#181818;stroke-width:1.0;" width="10" x="2038" y="2174.1094"/><polygon fill="#181818" points="720,277.2656,730,281.2656,720,285.2656,724,281.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="726" y1="281.2656" y2="281.2656"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="352" x="63" y="158.1426">DELETE /api/operationrequest/{id}</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="108" x="63" y="181.4238">Headers: {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="265" x="75" y="204.7051">Authorization: Bearer JWT,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="308" x="75" y="227.9863">Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="63" y="251.2676">}</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="239" x="63" y="274.5488">Query: confirmed=false</text><line style="stroke:#181818;stroke-width:1.0;" x1="742" x2="784" y1="388.3906" y2="388.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="784" y1="388.3906" y2="401.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="743" x2="784" y1="401.3906" y2="401.3906"/><polygon fill="#181818" points="753,397.3906,743,401.3906,753,405.3906,749,401.3906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="279" x="749" y="311.8301">[Authorize(Roles = "Staff")]</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="527" x="749" y="335.1113">var currentStaffId = User.FindFirst("StaffId")?.Value;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="399" x="749" y="358.3926">if (string.IsNullOrEmpty(currentStaffId))</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="414" x="761" y="381.6738">return Unauthorized("User is not a staff")</text><polygon fill="#181818" points="1419,434.6719,1429,438.6719,1419,442.6719,1423,438.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="742" x2="1425" y1="438.6719" y2="438.6719"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="563" x="749" y="431.9551">GetByIdAsync(new OperationRequestId(Guid.Parse(id)))</text><polygon fill="#181818" points="2971,471.9531,2981,475.9531,2971,479.9531,2975,475.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1441" x2="2977" y1="475.9531" y2="475.9531"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="174" x="1448" y="469.2363">GetByIdAsync(id)</text><polygon fill="#181818" points="3274,579.0781,3284,583.0781,3274,587.0781,3278,583.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2983" x2="3280" y1="583.0781" y2="583.0781"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="92" x="2990" y="506.5176">SELECT *</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="257" x="2990" y="529.7988">FROM OperationRequests</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="168" x="2990" y="553.0801">WHERE Id = @id</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="220" x="3002" y="576.3613">AND IsDeleted = false</text><polygon fill="#181818" points="2994,616.3594,2984,620.3594,2994,624.3594,2990,620.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2988" x2="3285" y1="620.3594" y2="620.3594"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="3000" y="613.6426">OperationRequest</text><polygon fill="#181818" points="1452,653.6406,1442,657.6406,1452,661.6406,1448,657.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1446" x2="2982" y1="657.6406" y2="657.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1458" y="650.9238">OperationRequest</text><polygon fill="#181818" points="753,690.9219,743,694.9219,753,698.9219,749,694.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="747" x2="1430" y1="694.9219" y2="694.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="759" y="688.2051">OperationRequest</text><line style="stroke:#181818;stroke-width:1.0;" x1="742" x2="784" y1="848.6094" y2="848.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="784" x2="784" y1="848.6094" y2="861.6094"/><line style="stroke:#181818;stroke-width:1.0;" x1="743" x2="784" y1="861.6094" y2="861.6094"/><polygon fill="#181818" points="753,857.6094,743,861.6094,753,865.6094,749,861.6094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="195" x="749" y="725.4863">if (request == null)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="189" x="761" y="748.7676">return NotFound();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="526" x="749" y="772.0488">if (request.CreatedByStaffId.Value != currentStaffId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="663" x="761" y="795.3301">return StatusCode(403, "You can only delete your own requests");</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="485" x="749" y="818.6113">if (request.Status == RequestStatus.Scheduled)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="594" x="761" y="841.8926">return BadRequest("Cannot delete scheduled operations");</text><path d="M10,876.6094 L86,876.6094 L86,891.8906 L76,901.8906 L10,901.8906 L10,876.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="201.25" style="stroke:#000000;stroke-width:1.5;" width="835" x="10" y="876.6094"/><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="31" x="25" y="896.1738">alt</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="142" x="101" y="897.1738">[!confirmed]</text><polygon fill="#181818" points="67,1028.5781,57,1032.5781,67,1036.5781,63,1032.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="731" y1="1032.5781" y2="1032.5781"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="158" x="73" y="932.7363">202 Accepted {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="572" x="85" y="956.0176">message: "Please confirm deletion of operation request",</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="273" x="85" y="979.2988">requiresConfirmation: true,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="640" x="85" y="1002.5801">confirmationUrl: "/api/OperationRequest/{id}?confirmed=true"</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="73" y="1025.8613">}</text><polygon fill="#181818" points="720,1065.8594,730,1069.8594,720,1073.8594,724,1069.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="726" y1="1069.8594" y2="1069.8594"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="523" x="63" y="1063.1426">DELETE /api/operationrequest/{id}?confirmed=true</text><polygon fill="#181818" points="1424,1110.1406,1434,1114.1406,1424,1118.1406,1428,1114.1406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="742" x2="1430" y1="1114.1406" y2="1114.1406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="492" x="749" y="1107.4238">DeleteOperationRequestAsync(id, currentStaffId)</text><polygon fill="#181818" points="2971,1147.4219,2981,1151.4219,2971,1155.4219,2975,1151.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="2977" y1="1151.4219" y2="1151.4219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="563" x="1453" y="1144.7051">GetByIdAsync(new OperationRequestId(Guid.Parse(id)))</text><polygon fill="#181818" points="3274,1277.8281,3284,1281.8281,3274,1285.8281,3278,1281.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2983" x2="3280" y1="1281.8281" y2="1281.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="92" x="2990" y="1181.9863">SELECT *</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="257" x="2990" y="1205.2676">FROM OperationRequests</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="168" x="2990" y="1228.5488">WHERE Id = @id</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="220" x="3002" y="1251.8301">AND IsDeleted = false</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="129" x="2990" y="1275.1113">FOR UPDATE</text><polygon fill="#181818" points="2994,1315.1094,2984,1319.1094,2994,1323.1094,2990,1319.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2988" x2="3285" y1="1319.1094" y2="1319.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="3000" y="1312.3926">OperationRequest</text><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="1488" y1="1682.3281" y2="1682.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1488" x2="1488" y1="1682.3281" y2="1695.3281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1447" x2="1488" y1="1695.3281" y2="1695.3281"/><polygon fill="#181818" points="1457,1691.3281,1447,1695.3281,1457,1699.3281,1453,1695.3281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="509" x="1453" y="1349.6738">operationRequest.MarkAsDeleted(currentStaffId) {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="323" x="1465" y="1372.9551">if (string.IsNullOrEmpty(staffId))</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="375" x="1477" y="1396.2363">throw new ArgumentNullException();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="403" x="1465" y="1419.5176">if (Status == RequestStatus.Scheduled)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="469" x="1477" y="1442.7988">throw new BusinessRuleValidationException();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="368" x="1465" y="1466.0801">if (CreatedByStaffId.Value != staffId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="438" x="1477" y="1489.3613">throw new UnauthorizedAccessException();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="129" x="1465" y="1512.6426">if (IsDeleted)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="469" x="1477" y="1535.9238">throw new BusinessRuleValidationException();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="6" x="1453" y="1559.2051">Â </text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="171" x="1465" y="1582.4863">IsDeleted = true;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="317" x="1465" y="1605.7676">DeletedAt = DateTime.UtcNow;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="202" x="1465" y="1629.0488">DeletedBy = staffId;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="351" x="1465" y="1652.3301">Status = RequestStatus.Cancelled;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="1453" y="1675.6113">}</text><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="1488" y1="1849.0156" y2="1849.0156"/><line style="stroke:#181818;stroke-width:1.0;" x1="1488" x2="1488" y1="1849.0156" y2="1862.0156"/><line style="stroke:#181818;stroke-width:1.0;" x1="1447" x2="1488" y1="1862.0156" y2="1862.0156"/><polygon fill="#181818" points="1457,1858.0156,1447,1862.0156,1457,1866.0156,1453,1862.0156" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="578" x="1453" y="1725.8926">var deletionEvent = new OperationRequestDeletedEvent(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="209" x="1465" y="1749.1738">operationRequest.Id,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="145" x="1465" y="1772.4551">currentStaffId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="181" x="1465" y="1795.7363">DateTime.UtcNow</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="15" x="1453" y="1819.0176">);</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="521" x="1453" y="1842.2988">operationRequest.AddDomainEvent(deletionEvent);</text><polygon fill="#181818" points="2785,1988.4219,2795,1992.4219,2785,1996.4219,2789,1992.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="2791" y1="1992.4219" y2="1992.4219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="199" x="1453" y="1892.5801">AddAsync(new Log(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="212" x="1465" y="1915.8613">TypeOfAction.Delete,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="316" x="1465" y="1939.1426">operationRequest.Id.ToString(),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="533" x="1465" y="1962.4238">$"Operation request deleted by Dr. {currentStaffId}"</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="16" x="1453" y="1985.7051">))</text><polygon fill="#181818" points="3274,2095.5469,3284,2099.5469,3274,2103.5469,3278,2099.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2797" x2="3280" y1="2099.5469" y2="2099.5469"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="194" x="2804" y="2022.9863">INSERT INTO Logs (</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="262" x="2816" y="2046.2676">Id, TypeOfAction, EntityId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="211" x="2816" y="2069.5488">Message, Timestamp</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="200" x="2804" y="2092.8301">) VALUES (@values)</text><polygon fill="#181818" points="2808,2132.8281,2798,2136.8281,2808,2140.8281,2804,2136.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2802" x2="3285" y1="2136.8281" y2="2136.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="55" x="2814" y="2130.1113">LogId</text><polygon fill="#181818" points="2026,2170.1094,2036,2174.1094,2026,2178.1094,2030,2174.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="2032" y1="2174.1094" y2="2174.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="354" x="1453" y="2167.3926">NotifyOperationRequestDeleted(id)</text><line style="stroke:#181818;stroke-width:1.0;" x1="2048" x2="2090" y1="2351.0781" y2="2351.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="2090" x2="2090" y1="2351.0781" y2="2364.0781"/><line style="stroke:#181818;stroke-width:1.0;" x1="2049" x2="2090" y1="2364.0781" y2="2364.0781"/><polygon fill="#181818" points="2059,2360.0781,2049,2364.0781,2059,2368.0781,2055,2364.0781" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="46" x="2055" y="2204.6738">try {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="466" x="2067" y="2227.9551">var response = await _httpClient.DeleteAsync(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="574" x="2079" y="2251.2363">$"{_planningModuleUrl}/api/planning/operations/{id}");</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="383" x="2067" y="2274.5176">response.EnsureSuccessStatusCode();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="243" x="2055" y="2297.7988">} catch (Exception ex) {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="718" x="2067" y="2321.0801">Console.WriteLine($"Failed to notify planning module: {ex.Message}");</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="2055" y="2344.3613">}</text><polygon fill="#181818" points="1457,2397.3594,1447,2401.3594,1457,2405.3594,1453,2401.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1451" x2="2042" y1="2401.3594" y2="2401.3594"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="42" x="1463" y="2394.6426">void</text><polygon fill="#181818" points="2971,2434.6406,2981,2438.6406,2971,2442.6406,2975,2438.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="2977" y1="2438.6406" y2="2438.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="334" x="1453" y="2431.9238">RemoveAsync(operationRequest)</text><polygon fill="#181818" points="3274,2588.3281,3284,2592.3281,3274,2596.3281,3278,2592.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2983" x2="3280" y1="2592.3281" y2="2592.3281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="279" x="2990" y="2469.2051">UPDATE OperationRequests</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="214" x="2990" y="2492.4863">SET IsDeleted = true,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="197" x="3014" y="2515.7676">DeletedAt = @now,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="221" x="3014" y="2539.0488">DeletedBy = @staffId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="204" x="3014" y="2562.3301">Status = 'Cancelled'</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="168" x="2990" y="2585.6113">WHERE Id = @id</text><polygon fill="#181818" points="2994,2625.6094,2984,2629.6094,2994,2633.6094,2990,2629.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2988" x2="3285" y1="2629.6094" y2="2629.6094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="80" x="3000" y="2622.8926">Success</text><polygon fill="#181818" points="3274,2662.8906,3284,2666.8906,3274,2670.8906,3278,2666.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1446" x2="3280" y1="2666.8906" y2="2666.8906"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="205" x="1453" y="2660.1738">COMMIT Transaction</text><polygon fill="#181818" points="1457,2700.1719,1447,2704.1719,1457,2708.1719,1453,2704.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1451" x2="3285" y1="2704.1719" y2="2704.1719"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="80" x="1463" y="2697.4551">Success</text><polygon fill="#181818" points="753,2737.4531,743,2741.4531,753,2745.4531,749,2741.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="747" x2="1430" y1="2741.4531" y2="2741.4531"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="41" x="759" y="2734.7363">true</text><polygon fill="#181818" points="67,2774.7344,57,2778.7344,67,2782.7344,63,2778.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="736" y1="2778.7344" y2="2778.7344"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="158" x="73" y="2772.0176">204 No Content</text><path d="M3291,2791.7344 L3291,2917.7344 L4274,2917.7344 L4274,2801.7344 L4264,2791.7344 L3291,2791.7344 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M4264,2791.7344 L4264,2801.7344 L4274,2801.7344 L4264,2791.7344 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="221" x="3297" y="2815.2988">Database Constraints:</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="281" x="3297" y="2838.5801">- PK_OperationRequests (Id)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="395" x="3297" y="2861.8613">- FK_OperationRequests_Staffs (StaffId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="962" x="3297" y="2885.1426">- CK_OperationRequests_Status IN ('Pending','Approved',\n'Scheduled','Completed','Cancelled')</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="497" x="3297" y="2908.4238">- CK_OperationRequests_IsDeleted DEFAULT false</text><path d="M742,2928.1406 L742,3100.1406 L1096,3100.1406 L1096,2938.1406 L1086,2928.1406 L742,2928.1406 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M1086,2928.1406 L1086,2938.1406 L1096,2938.1406 L1086,2928.1406 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="153" x="748" y="2951.7051">Error Handling:</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="333" x="748" y="2974.9863">- 400: Invalid Request/Scheduled</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="201" x="748" y="2998.2676">- 401: Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="258" x="748" y="3021.5488">- 403: Not Original Doctor</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="257" x="748" y="3044.8301">- 404: Request Not Found</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="184" x="748" y="3068.1113">- 500: Server Error</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="297" x="748" y="3091.3926">All errors logged to AuditLogs</text><!--SRC=[jLTjRzis4FwkNt7L2bWU72ThioyUiiOlSklDYJFBQJ7CGy1AjCD59bMISke6-UyxKY-M56Vj1gn0cvHtl3i-T_VSITqndX19Dh48xsW44LsHDDPZmNN0lb1uTU9efcCA8n5g8M6MK4aq4npcz5DAbOOHZQaz6CVY7evWIhSqXjUEG-o5x9w3FZGBMKAu1hSqajjOyY7waoAEgNI1A9ZDXr-x4L2vPI7DrOEw-bLCE6TyVI6YDAPBVYaqMx7S-DN5PLrxAjPpcWZ5CD2TLPdEl-Q-SM4sToAYoKUYABYZ_3Sh6GqS9yVkw6Vpi1wC_Ac_yE6O9EnO59PbPlduWKMFI_wEaeXArOE79GVef_fMIFR5AlPWG8ca4dxviEWOgS6ESdsqs2Mq1oH9OXPQpUE_bE1BZkP-IwdSzI0KVCNaXaPdAn8hQZB4jaHJYxU3_vGX_b6ufDvSn5J16RY19gkLs_vpoRT4GfXAYLxjuIH2-RMYiZjcF1epgRJdvXAt_QRxdiGf_Md9sGeyfIKcfZjHbsaSpwI_IVJEgnjhjysp9DMfv73DIH5AvBd62J05N6WWeBA8Ag47FNXBzM0tYVfgnqEFqtje9cyIUMzJ5dMlY5JKO-YkNKKYG6j1PgrX35LHPaIZGGy2pE9m0Tyl-NW-ktZYHItvXtV-t0SBpZcBR28lHp1HjcEeESxIC1h0KUwlQSNwArvsG1Zaqk41gTE22MUQaHYs96QH5TQoRFAHrnsSdG77Z5IXnwuPYvH7NZlFNQxR7KgAM4M3NPwmBC7mugnH5LLZUAHJDHGHzKvFNdV0_Lsa418EWiSxf1q32Un4Aa7SSyWzARVfEZDZeisVcHrqW_2Mcbwl-HoGADVot24o0XPDxaWLwb0seF65f1LhU57sYGFuno9cacwxk8UK-0hwOKWJaqFRdnkg55bZyo7nK4C1kO7Cc-56iTexAXxdTh9GFwLCKaJ6NibRNCkKMd5OERwMCRgmjD5CjgMDD_l-DlTTR7txW7zBFmqx3kLHlSMo0cx6K3H9fra5zUx2iiIkAa00mgEYFEcpdVUjRVm_T2SQGAlNLwF-ml_7JiLtNH1vPpW_Ax9e_np4J3JqkqQvNtXhCc1MLy_ofQeI9O2-bJXw3KXzkKutQCSe-vzDZQ97sx-PjMzhdwh5GQeOn_gUe_HzIIE7R3_F2gf21rNRLMut7QNK8RjbIlvJREPEDQccegtf_AYFr0SuiUc2RMZtMeUNuhug7-oWV80zBo1i88Zy4b9SO8pIeoc630w8n8Om3hWKSLqh23D42txmZHHD7ghpF0whufa0dbJI9CgeebP2zgZnhYKtY3ovtu-YaOqoyr4Bod1Y-HQIHan3BDR5GwRO27XxtwIuIjaOpIuoM_L3OwURlQ3pJEpTXGXiZNjjg_9olssL994t57pSmKXsuQ7-r4TaEcp-QTdyayl0do_mns9c8b9WOq9CQd5rmEUus-voh2uo4aST10mJladGAhplJw_z0BpphIbcrIuemBmSJKyY0uzTBtUGv5idREpQMO24-sOlLtacjtQpA4dIxAVujxogvIwZ0rCnE2aId5KKYuNS4yp6pQtMoJ1c24SET9QDh5TUkWytIMqPnY7oQAc_EDxF06NPtyqwht3KzRbA9GrIsv-LAMxK7d62w_0MlBBdW7xEoGi7ciBLiVj1CasdsAVUItTCc9cvMfW5xW1akE_Ipzqy4raaZnaMPTS85ZaHhO656GZ85gVkBU5hggfJP4utOfiZqgozwhZ8-FtGc0ZynHF-w6JWLXdad8lx-h4bZdDLwSOATxHAkcWr9r5roEIeEyMJJAZ3sSN5P04BIRWYjf3tDuBcbMBcspbUWSqEugUBpIdMQV4zKLV7xmDC6GN9rhVQh3Feyxkf-SzRIIc6K7pzcBHhYMIYLSyvWgjVRvw0YfIEzNu4umEo6zlJoawgR7auWk4pUWRAoILuhIlSKB28MfrMFqaa9Zng8U2jSgYXO2WsYKsB-Rt4_bdh-uoF_77_Uhh8LtLqP4gNDj4mK6Pm390c75zANBZUuMuJOrm6XzEJ4-GbRZUTOd8Sbm5QXHzwjO5eprvRve0PEc8S5_dyQzg8Jdlb9xXHiPiw2duqZip7CNuesJ2SVXm3DRyfGzthhF_wXieDD-wVz3S0]--></g></svg>