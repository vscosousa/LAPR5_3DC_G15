<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="3182px" preserveAspectRatio="none" style="width:4150px;height:3182px;background:#FFFFFF;" version="1.1" viewBox="0 0 4150 3182" width="4150px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="382" x="1882.5" y="27.9951">Doctor Operation Request Update Flow - Level 3</text><rect fill="#FFFFFF" height="2220.0938" style="stroke:#181818;stroke-width:1.0;" width="10" x="618" y="467.5156"/><rect fill="#FFFFFF" height="1847.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="1136" y="733.0469"/><rect fill="#FFFFFF" height="278.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1796" y="1915.2969"/><rect fill="none" height="94.125" style="stroke:#000000;stroke-width:1.5;" width="721" x="10" y="602.6406"/><rect fill="none" height="131.4063" style="stroke:#000000;stroke-width:1.5;" width="1239" x="10" y="920.4531"/><rect fill="none" height="131.4063" style="stroke:#000000;stroke-width:1.5;" width="1239" x="10" y="1065.8594"/><rect fill="none" height="107.125" style="stroke:#000000;stroke-width:1.5;" width="832.5" x="1703.5" y="2050.4219"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="56" x2="56" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="623" x2="623" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1141" x2="1141" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1800.5" x2="1800.5" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2536" x2="2536" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2722" x2="2722" y1="125.5781" y2="3094.8281"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="3155" x2="3155" y1="125.5781" y2="3094.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="66" x="20" y="120.8613">Doctor</text><ellipse cx="56" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,58.7969 L56,85.7969 M43,66.7969 L69,66.7969 M56,85.7969 L43,100.7969 M56,85.7969 L69,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="66" x="20" y="3112.3926">Doctor</text><ellipse cx="56" cy="3125.6094" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M56,3133.6094 L56,3160.6094 M43,3141.6094 L69,3141.6094 M56,3160.6094 L43,3175.6094 M56,3160.6094 L69,3175.6094 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="525" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="532" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="573.5" y="112.8613">Controller</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="525" y="3093.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="532" y="3119.3926">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="99" x="573.5" y="3142.6738">Controller</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="1043" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1050" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="73" x="1104.5" y="112.8613">Service</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="1043" y="3093.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1050" y="3119.3926">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="73" x="1104.5" y="3142.6738">Service</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="1713.5" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="161" x="1720.5" y="89.5801">PlanningModule</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="74" x="1764" y="112.8613">Notifier</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="175" x="1713.5" y="3093.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="161" x="1720.5" y="3119.3926">PlanningModule</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="74" x="1764" y="3142.6738">Notifier</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="2458" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="142" x="2465" y="112.8613">LogRepository</text><rect fill="#E2E2F0" height="37.2813" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="2458" y="3093.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="142" x="2465" y="3119.3926">LogRepository</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2624" y="64.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="2631" y="89.5801">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="106" x="2669" y="112.8613">Repository</text><rect fill="#E2E2F0" height="60.5625" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="2624" y="3093.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="2631" y="3119.3926">OperationRequest</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="106" x="2669" y="3142.6738">Repository</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="94" x="3105" y="120.8613">Database</text><path d="M3137,66.2969 C3137,56.2969 3155,56.2969 3155,56.2969 C3155,56.2969 3173,56.2969 3173,66.2969 L3173,92.2969 C3173,102.2969 3155,102.2969 3155,102.2969 C3155,102.2969 3137,102.2969 3137,92.2969 L3137,66.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M3137,66.2969 C3137,76.2969 3155,76.2969 3155,76.2969 C3155,76.2969 3173,76.2969 3173,66.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="94" x="3105" y="3112.3926">Database</text><path d="M3137,3127.1094 C3137,3117.1094 3155,3117.1094 3155,3117.1094 C3155,3117.1094 3173,3117.1094 3173,3127.1094 L3173,3153.1094 C3173,3163.1094 3155,3163.1094 3155,3163.1094 C3155,3163.1094 3137,3163.1094 3137,3153.1094 L3137,3127.1094 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M3137,3127.1094 C3137,3137.1094 3155,3137.1094 3155,3137.1094 C3155,3137.1094 3173,3137.1094 3173,3127.1094 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="2220.0938" style="stroke:#181818;stroke-width:1.0;" width="10" x="618" y="467.5156"/><rect fill="#FFFFFF" height="1847.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="1136" y="733.0469"/><rect fill="#FFFFFF" height="278.5313" style="stroke:#181818;stroke-width:1.0;" width="10" x="1796" y="1915.2969"/><polygon fill="#181818" points="606,463.5156,616,467.5156,606,471.5156,610,467.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="56" x2="612" y1="467.5156" y2="467.5156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="314" x="63" y="158.1426">PUT /api/operationrequest/{id}</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="108" x="63" y="181.4238">Headers: {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="265" x="75" y="204.7051">Authorization: Bearer JWT,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="308" x="75" y="227.9863">Content-Type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="63" y="251.2676">}</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="380" x="63" y="274.5488">Body: UpdateOperationRequestDTO {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="96" x="75" y="297.8301">id: string,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="168" x="75" y="321.1113">patientId: string,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="140" x="75" y="344.3926">staffId: string,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="240" x="75" y="367.6738">operationTypeId: string,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="203" x="75" y="390.9551">deadline: DateTime,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="214" x="75" y="414.2363">priority: PriorityLevel,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="220" x="75" y="437.5176">status: RequestStatus</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="63" y="460.7988">}</text><line style="stroke:#181818;stroke-width:1.0;" x1="628" x2="670" y1="574.6406" y2="574.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="670" x2="670" y1="574.6406" y2="587.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="629" x2="670" y1="587.6406" y2="587.6406"/><polygon fill="#181818" points="639,583.6406,629,587.6406,639,591.6406,635,587.6406" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="298" x="635" y="498.0801">[Authorize(Roles = "Doctor")]</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="137" x="635" y="521.3613">ValidateJWT()</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="259" x="635" y="544.6426">doctorId = User.FindFirst(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="354" x="647" y="567.9238">ClaimTypes.NameIdentifier)?.Value</text><path d="M10,602.6406 L86,602.6406 L86,617.9219 L76,627.9219 L10,627.9219 L10,602.6406 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="94.125" style="stroke:#000000;stroke-width:1.5;" width="721" x="10" y="602.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="31" x="25" y="622.2051">alt</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="146" x="101" y="623.2051">[id != dto.Id]</text><polygon fill="#181818" points="67,684.7656,57,688.7656,67,692.7656,63,688.7656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="617" y1="688.7656" y2="688.7656"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="172" x="73" y="658.7676">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="147" x="73" y="682.0488">"ID mismatch"</text><polygon fill="#181818" points="1124,729.0469,1134,733.0469,1124,737.0469,1128,733.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="628" x2="1130" y1="733.0469" y2="733.0469"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="489" x="635" y="726.3301">UpdateOperationRequestAsync(id, dto, doctorId)</text><polygon fill="#181818" points="2710,766.3281,2720,770.3281,2710,774.3281,2714,770.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="2716" y1="770.3281" y2="770.3281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="563" x="1153" y="763.6113">GetByIdAsync(new OperationRequestId(Guid.Parse(id)))</text><polygon fill="#181818" points="3143,826.8906,3153,830.8906,3143,834.8906,3147,830.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2722" x2="3149" y1="830.8906" y2="830.8906"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="355" x="2729" y="800.8926">SELECT * FROM OperationRequests</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="360" x="2729" y="824.1738">WHERE Id = @id AND IsDeleted = 0</text><polygon fill="#181818" points="2733,864.1719,2723,868.1719,2733,872.1719,2729,868.1719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2727" x2="3154" y1="868.1719" y2="868.1719"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="2739" y="861.4551">OperationRequest</text><polygon fill="#181818" points="1157,901.4531,1147,905.4531,1157,909.4531,1153,905.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1151" x2="2721" y1="905.4531" y2="905.4531"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="182" x="1163" y="898.7363">OperationRequest</text><path d="M10,920.4531 L86,920.4531 L86,935.7344 L76,945.7344 L10,945.7344 L10,920.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="131.4063" style="stroke:#000000;stroke-width:1.5;" width="1239" x="10" y="920.4531"/><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="31" x="25" y="940.0176">alt</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="236" x="101" y="941.0176">[Request Not Found]</text><polygon fill="#181818" points="639,1002.5781,629,1006.5781,639,1010.5781,635,1006.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1135" y1="1006.5781" y2="1006.5781"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="297" x="645" y="976.5801">throw KeyNotFoundException</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="311" x="645" y="999.8613">"Operation Request not found"</text><polygon fill="#181818" points="67,1039.8594,57,1043.8594,67,1047.8594,63,1043.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="617" y1="1043.8594" y2="1043.8594"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="149" x="73" y="1037.1426">404 Not Found</text><path d="M10,1065.8594 L86,1065.8594 L86,1081.1406 L76,1091.1406 L10,1091.1406 L10,1065.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="131.4063" style="stroke:#000000;stroke-width:1.5;" width="1239" x="10" y="1065.8594"/><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="31" x="25" y="1085.4238">alt</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="671" x="101" y="1086.4238">[existingRequest.StaffId.ToString() != requestingDoctorId]</text><polygon fill="#181818" points="639,1147.9844,629,1151.9844,639,1155.9844,635,1151.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1135" y1="1151.9844" y2="1151.9844"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="367" x="645" y="1121.9863">throw UnauthorizedAccessException</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="408" x="645" y="1145.2676">"Only the requesting doctor can update"</text><polygon fill="#181818" points="67,1185.2656,57,1189.2656,67,1193.2656,63,1189.2656" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="617" y1="1189.2656" y2="1189.2656"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="147" x="73" y="1182.5488">403 Forbidden</text><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="1188" y1="1256.8281" y2="1256.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1188" x2="1188" y1="1256.8281" y2="1269.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="1147" x2="1188" y1="1269.8281" y2="1269.8281"/><polygon fill="#181818" points="1157,1265.8281,1147,1269.8281,1157,1273.8281,1153,1269.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="449" x="1153" y="1226.8301">var oldDeadline = existingRequest.Deadline;</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="413" x="1153" y="1250.1113">var oldPriority = existingRequest.Priority;</text><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="1188" y1="1446.7969" y2="1446.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="1188" x2="1188" y1="1446.7969" y2="1459.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="1147" x2="1188" y1="1459.7969" y2="1459.7969"/><polygon fill="#181818" points="1157,1455.7969,1147,1459.7969,1157,1463.7969,1153,1459.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="317" x="1153" y="1300.3926">existingRequest.UpdateDetails(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="289" x="1165" y="1323.6738">new PatientId(dto.PatientId),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="241" x="1165" y="1346.9551">new StaffId(dto.StaffId),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="443" x="1165" y="1370.2363">new OperationTypeId(dto.OperationTypeId),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="496" x="1165" y="1393.5176">dto.Deadline ?? throw new ArgumentException(),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="110" x="1165" y="1416.7988">dto.Priority</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="8" x="1153" y="1440.0801">)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="1188" y1="1590.2031" y2="1590.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1188" x2="1188" y1="1590.2031" y2="1603.2031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1147" x2="1188" y1="1603.2031" y2="1603.2031"/><polygon fill="#181818" points="1157,1599.2031,1147,1603.2031,1157,1607.2031,1153,1603.2031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="348" x="1153" y="1490.3613">var changes = new List&lt;string&gt;();</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="320" x="1153" y="1513.6426">if (oldDeadline != dto.Deadline)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="624" x="1165" y="1536.9238">changes.Add($"Deadline: {oldDeadline} -&gt; {dto.Deadline}");</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="284" x="1153" y="1560.2051">if (oldPriority != dto.Priority)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="570" x="1165" y="1583.4863">changes.Add($"Priority: {oldPriority} -&gt; {dto.Priority}");</text><polygon fill="#181818" points="2524,1729.6094,2534,1733.6094,2524,1737.6094,2528,1733.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="2530" y1="1733.6094" y2="1733.6094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="199" x="1153" y="1633.7676">AddAsync(new Log(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="220" x="1165" y="1657.0488">TypeOfAction.Update,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="299" x="1165" y="1680.3301">existingRequest.Id.ToString(),</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="589" x="1165" y="1703.6113">$"Operation request updated: {string.Join(", ", changes)}"</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="16" x="1153" y="1726.8926">))</text><polygon fill="#181818" points="3143,1836.7344,3153,1840.7344,3143,1844.7344,3147,1840.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2536" x2="3149" y1="1840.7344" y2="1840.7344"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="194" x="2543" y="1764.1738">INSERT INTO Logs (</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="191" x="2555" y="1787.4551">Id, Action, EntityId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="211" x="2555" y="1810.7363">Message, Timestamp</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="200" x="2543" y="1834.0176">) VALUES (@values)</text><polygon fill="#181818" points="2547,1874.0156,2537,1878.0156,2547,1882.0156,2543,1878.0156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2541" x2="3154" y1="1878.0156" y2="1878.0156"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="55" x="2553" y="1871.2988">LogId</text><polygon fill="#181818" points="1784,1911.2969,1794,1915.2969,1784,1919.2969,1788,1915.2969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="1790" y1="1915.2969" y2="1915.2969"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="550" x="1153" y="1908.5801">NotifyOperationRequestUpdateAsync(existingRequest)</text><line style="stroke:#181818;stroke-width:1.0;" x1="1806" x2="1848" y1="2022.4219" y2="2022.4219"/><line style="stroke:#181818;stroke-width:1.0;" x1="1848" x2="1848" y1="2022.4219" y2="2035.4219"/><line style="stroke:#181818;stroke-width:1.0;" x1="1807" x2="1848" y1="2035.4219" y2="2035.4219"/><polygon fill="#181818" points="1817,2031.4219,1807,2035.4219,1817,2039.4219,1813,2035.4219" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="434" x="1813" y="1945.8613">var response = await _httpClient.PutAsync(</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="565" x="1825" y="1969.1426">$"{_planningModuleUrl}/api/planning/operations/{id}",</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="524" x="1825" y="1992.4238">new StringContent(JsonSerializer.Serialize(request))</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="8" x="1813" y="2015.7051">)</text><path d="M1703.5,2050.4219 L1779.5,2050.4219 L1779.5,2065.7031 L1769.5,2075.7031 L1703.5,2075.7031 L1703.5,2050.4219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="107.125" style="stroke:#000000;stroke-width:1.5;" width="832.5" x="1703.5" y="2050.4219"/><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="31" x="1718.5" y="2069.9863">alt</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="255" x="1794.5" y="2070.9863">[HTTP Request Failed]</text><line style="stroke:#181818;stroke-width:1.0;" x1="1806" x2="1848" y1="2136.5469" y2="2136.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="1848" x2="1848" y1="2136.5469" y2="2149.5469"/><line style="stroke:#181818;stroke-width:1.0;" x1="1807" x2="1848" y1="2149.5469" y2="2149.5469"/><polygon fill="#181818" points="1817,2145.5469,1807,2149.5469,1817,2153.5469,1813,2149.5469" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="224" x="1813" y="2106.5488">Log error but continue</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="711" x="1813" y="2129.8301">Console.WriteLine($"Failed to notify planning module: {ex.Message}")</text><polygon fill="#181818" points="1157,2189.8281,1147,2193.8281,1157,2197.8281,1153,2193.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1151" x2="1800" y1="2193.8281" y2="2193.8281"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="42" x="1163" y="2187.1113">void</text><polygon fill="#181818" points="2710,2227.1094,2720,2231.1094,2710,2235.1094,2714,2231.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="2716" y1="2231.1094" y2="2231.1094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="309" x="1153" y="2224.3926">UpdateAsync(existingRequest)</text><polygon fill="#181818" points="3143,2427.3594,3153,2431.3594,3143,2435.3594,3147,2431.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2722" x2="3149" y1="2431.3594" y2="2431.3594"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="279" x="2729" y="2261.6738">UPDATE OperationRequests</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="280" x="2729" y="2284.9551">SET PatientId = @patientId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="184" x="2753" y="2308.2363">StaffId = @staffId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="385" x="2753" y="2331.5176">OperationTypeId = @operationTypeId,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="231" x="2753" y="2354.7988">Deadline = @deadline,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="198" x="2753" y="2378.0801">Priority = @priority,</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="199" x="2753" y="2401.3613">UpdatedAt = @now</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="168" x="2729" y="2424.6426">WHERE Id = @id</text><polygon fill="#181818" points="2733,2464.6406,2723,2468.6406,2733,2472.6406,2729,2468.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2727" x2="3154" y1="2468.6406" y2="2468.6406"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="80" x="2739" y="2461.9238">Success</text><polygon fill="#181818" points="3143,2501.9219,3153,2505.9219,3143,2509.9219,3147,2505.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1146" x2="3149" y1="2505.9219" y2="2505.9219"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="205" x="1153" y="2499.2051">COMMIT Transaction</text><polygon fill="#181818" points="1157,2539.2031,1147,2543.2031,1157,2547.2031,1153,2543.2031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1151" x2="3154" y1="2543.2031" y2="2543.2031"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="80" x="1163" y="2536.4863">Success</text><polygon fill="#181818" points="639,2576.4844,629,2580.4844,639,2584.4844,635,2580.4844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="633" x2="1140" y1="2580.4844" y2="2580.4844"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="161" x="645" y="2573.7676">existingRequest</text><polygon fill="#181818" points="67,2683.6094,57,2687.6094,67,2691.6094,63,2687.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61" x2="622" y1="2687.6094" y2="2687.6094"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="93" x="73" y="2611.0488">200 OK {</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="526" x="85" y="2634.3301">message: "Operation request updated successfully",</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="416" x="85" y="2657.6113">operationRequest: OperationRequestDTO</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="13" x="73" y="2680.8926">}</text><path d="M3160,2700.6094 L3160,2872.6094 L4143,2872.6094 L4143,2710.6094 L4133,2700.6094 L3160,2700.6094 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><path d="M4133,2700.6094 L4133,2710.6094 L4143,2710.6094 L4133,2700.6094 " fill="#90EE90" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="221" x="3166" y="2724.1738">Database Constraints:</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="281" x="3166" y="2747.4551">- PK_OperationRequests (Id)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="443" x="3166" y="2770.7363">- FK_OperationRequests_Patients (PatientId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="395" x="3166" y="2794.0176">- FK_OperationRequests_Staffs (StaffId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="597" x="3166" y="2817.2988">- FK_OperationRequests_OperationTypes (OperationTypeId)</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="962" x="3166" y="2840.5801">- CK_OperationRequests_Status IN ('Pending','Approved',\n'Scheduled','Completed','Cancelled')</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="588" x="3166" y="2863.8613">- CK_OperationRequests_Priority IN ('Low','Medium','High')</text><path d="M628,2883.5781 L628,3079.5781 L978,3079.5781 L978,2893.5781 L968,2883.5781 L628,2883.5781 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><path d="M968,2883.5781 L968,2893.5781 L978,2893.5781 L968,2883.5781 " fill="#ADD8E6" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="153" x="634" y="2907.1426">Error Handling:</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="329" x="634" y="2930.4238">- 400: Invalid Request/Validation</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="201" x="634" y="2953.7051">- 401: Unauthorized</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="258" x="634" y="2976.9863">- 403: Not Original Doctor</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="257" x="634" y="3000.2676">- 404: Request Not Found</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="142" x="634" y="3023.5488">- 409: Conflict</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="184" x="634" y="3046.8301">- 500: Server Error</text><text fill="#000000" font-family="sans-serif" font-size="20" lengthAdjust="spacing" textLength="297" x="634" y="3070.1113">All errors logged to AuditLogs</text><!--SRC=[XLVRSjis47tdLspLpeZisBARf0zbciIwnafaIoDAoKFLyI0a9AEXG9O4xIWU_tjtGO2YQAlnn0u9B7QnPs-7-LSXKvQnRPo4Nta44L-p8bQZHAf0VEVmujnHGiKS1aceaWocAS-O4ec4EV-tuBc2PHennM4K9_Tm2XD-nsDuwJXCYvUd7BIWH2XI9XMqAXL6mqhsqLgMn37FMi1ocCxxFpeHyEnEXDo81uVYivX9AUJcAecAcA_aTQB4MXZbiwlhG-b9ifdpDCa5NdIdHIRp7vbl79ZE7SI0VM4vXzR0FEcTGSzn37AdRyan7sRB1PonL9mbLcrMgZrx4D7ZIbvo5l4iz-5X9G6wXRfDCl5T2_hGuopZ6Npul3YXNGAEItMwsANS1vQciGYrvDa_UI9N4jNracZdco0r7HaifgKL4VcGgmmnqsfJ54AruyFLNB7rkh5M-K0tQEn5w4Wi95uC8U4BiUMbyaoWGmelDJDFEcUi2LMWw-P-WNv5DoYRn1sb6UM6WtygEF-o275tdiGyXpSO0eruo_jx9J-nM93hY9ZhhMIaTyOHIYrpddL6GaOZaUNArN36J6p9axnppRRe3uAWCyTxrq551SUqZXMY1J-zWKWbdN7a0Fxe- -25Ihi-l3e_XnwBeCgNrdW0Mv5lcGflMmwNKSs7u5XqklbEXgw8JiWK_Z5Nz-fW18xJXlTS0PCHt1bVWNyJkS8mWCaiD1QKndmIxkt6KQbSydjecXr7xlj2H9qPotAEvZtFm_DqVD3p8HXEXlq5_0gZ-VJgoLcCrUVBuNm86k4B1AfxFO1nFk0nLvpMpfr1JsD5TsaUrtOiA4ysDVQsws1DmoWff0r0O0vYHgZR35lHHxv36Iqo_1Rob3HX89xsBucQrYJMEXBBLpLZEdHji5bbWWAiNgNwdZO4naedA8kdiqW2NI6kHpbaueFl0nFTO-uifRN1esuOyZm_y4h6EnJaDONsQY6JKEZyEkRVI_Gj-o8Yp7RhNu1R799OvnGgH80oY9FD1XNlamc3TCSo4XkOKiS0DnstMwzNqWZRidz6s6wzfakOmM9SmdQYc8Zp0_FDy-MHGIcfIveoV6RRcKirMxrv9rR014Tlc-VzvlImnMcXnbefJ1iL4E_UcS2HYcwsARPeimgPkpzXNLv9ZvnUP2py2k4javiVm6vbtcWJ4mJYpxBvldKz15kimQr7ndGi- -wHVQEYquqYzvVMeEhN3xM3ZsJqeNxqiLNJNmNJwBVlp-YVLOt_eNPmhxzQGVq4HJ_Z57zMH48H2XQ12NOErBZlO3Z1TQmf6DDrDoI4JIfec9jPSb26MkANMb-m-LOM3OwqXnBMpeT4IBTr0lZFEEOzjZ1idZEfskFuEXZE5_WVJbQyLWxwOcFiuUMrJc288qLX0zPshx2EsOQV04r777xR5FN1f-vaEGp0lIYBpxCjann7fMDTefhKx20rN0UscknOZ93b-4QasKTBO4hq6iZKHWlH9FojT576PJnF4vbJbRDxXa6vkLKgxSTKJfrPOGPMYUV3JNh0mfPP_AXPZrtUqvzS4vzMhHe9RaDjt0z8P93j2Uoutt5WLu-kYPFdKULGoxrSB6PLLnzX1-1bDwsxWV01pp8igo-5WX1j25bmpK1pP0-TpvY0V899ZlbQgW2Lq8Xu1clC3FwjOqA8IQkRfpPMbMaY8WTfK1rKwgxiZjiKge_c_utCVWGlPuFkOlZSx0s6Ytspem5S4JaDBjX6Hrk6pPcDHaCZWGQrCuArJdzX2PxPglNr2qlop5RfMTHLj2UJ-oPDg9E2eD3ZpR78aClzwTNLU47DKUPC5zB-HD0yOWTd0y9w83HnQax25yZQfXzBGhmje-h3ySO0UMbrNSJnhdN8Xet9foG66JVHsOEh8A751CD19pQt2f8rUWm_J-ZbVSPn9jiF2cBxs8gOa2htdLEOVRnvaWFW4a4yXT4pUpScDL1eFmEFoUfCGKax3e_97IGEoZSd8vxh7z6Fr1uR9RZj6HOEngbzqkwcQPRSyQYDSBQ3y9PJdU5RkvziKqqXwPd9aCUqVbHxbOfQ_oIvnsDNF1B55Xyk4TgshbOgRDv4dzAYXBz7Z7-ekyKbycjCzGtXZkmU6xtKRDlscpF322apIU8t_u2nwRMNkYF352q9oMBxRKnRh_ndY2rj_E5JrDVuMQVm_NUoJ9- - -0cex-LquxZiPxdc2MMxwjB4fEcpz_4_]--></g></svg>